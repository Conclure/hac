plugins {
    id 'base'
    id 'net.ltgt.errorprone' version '1.3.0' apply false
}

ext {
    /* define version for subprojects */
    PLUGIN_VERSION = rootProject.version.toString()

    /* define latest spigot API for subprojects */
    LATEST_SPIGOT = 'org.spigotmc:spigot-api:1.16.4-R0.1-SNAPSHOT'

    /* Spigot jar version */
    /* Place a compiled Spigot Jar in the libs/ folder with the specified names seen here to build implementation */
    /* You don't need all jar versions you just need the jar for the version you want to compile. */
    EIGHT_R3 = file(buildDir.parentFile.path + '/libs/1_8_R3.jar')
    NINE_R2 = file(buildDir.parentFile.path + '/libs/1_9_R2.jar')
    TEN_R1 = file(buildDir.parentFile.path + '/libs/spigot-1.10.2.jar')
    ELEVEN_R1 = file(buildDir.parentFile.path + '/libs/spigot-1.11.2.jar')
    TWELVE_R1 = file(buildDir.parentFile.path + '/libs/spigot-1.12.2.jar')
    THIRTEEN_R2 = file(buildDir.parentFile.path + '/libs/spigot-1.13.2.jar')
    FOURTEEN_R1 = file(buildDir.parentFile.path + '/libs/spigot-1.14.4.jar')
    FIFTEEN_R1 = file(buildDir.parentFile.path + '/libs/spigot-1.15.2.jar')
    SIXTEEN_R3 = file(buildDir.parentFile.path + '/libs/1_16_R3.jar')

    USE_EIGHT_R3 = false
    USE_NINE_R2 = false
    USE_TEN_R1 = false
    USE_ELEVEN_R1 = false
    USE_TWELVE_R1 = false
    USE_THIRTEEN_R2 = false
    USE_FOURTEEN_R1 = false
    USE_FIFTEEN_R1 = false
    USE_SIXTEEN_R3 = false
}

group 'com.heretere'

/* This is used to change the version for all subprojects */
version '0.0.6'

/* Project wide dependencies */
allprojects {
    repositories {
        mavenCentral()
        maven {
            url "https://hub.spigotmc.org/nexus/content/repositories/snapshots"
        }
    }

    /* Apply errorprone to all project sources */
    pluginManager.withPlugin('net.ltgt.errorprone') {
        dependencies {
            errorprone("com.google.errorprone:error_prone_core:2.4.0")
        }
    }

    /* Project wide dependencies */
    pluginManager.withPlugin('java-library') {
        dependencies {
            compileOnlyApi("org.jetbrains:annotations:16.0.2")
        }

        compileJava {
            /* Insure that all versions are compiled with 1.8 support */
            sourceCompatibility = JavaVersion.VERSION_1_8
            targetCompatibility = JavaVersion.VERSION_1_8
        }
    }
}

subprojects {
    /* Project wide plugins */
    apply plugin: 'net.ltgt.errorprone'
}

task build1_8_R3 {
    doFirst {
        USE_EIGHT_R3 = true
    }
}

task build1_9_R2 {
    doFirst {
        USE_NINE_R2 = true
    }
}

task build1_10_R1 {
    doFirst {
        USE_TEN_R1 = true
    }
}

task build1_11_R1 {
    doFirst {
        USE_ELEVEN_R1 = true
    }
}

task build1_12_R1 {
    doFirst {
        USE_TWELVE_R1 = true
    }
}

task build1_13_R2 {
    doFirst {
        USE_THIRTEEN_R2 = true
    }
}

task build1_14_R1 {
    doFirst {
        USE_FOURTEEN_R1 = true
    }
}

task build1_15_R1 {
    doFirst {
        USE_FIFTEEN_R1 = true
    }
}

task build1_16_R3 {
    doFirst {
        USE_SIXTEEN_R3 = true
    }
}

/* Will build as many as possible depending on the available jars */
task 'Build All' {
    dependsOn build1_8_R3
    dependsOn build1_9_R2
    dependsOn build1_10_R1
    dependsOn build1_11_R1
    dependsOn build1_12_R1
    dependsOn build1_13_R2
    dependsOn build1_14_R1
    dependsOn build1_15_R1
    dependsOn build1_16_R3
}